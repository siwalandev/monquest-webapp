generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Role {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  permissions Json
  isSystem    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       User[]

  @@index([slug])
  @@map("roles")
}

model User {
  id            String        @id @default(cuid())
  email         String?       @unique
  password      String?
  name          String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  lastLogin     DateTime?
  status        Status        @default(ACTIVE)
  roleId        String
  authMethod    AuthMethod    @default(EMAIL)
  privyId       String?       @unique
  walletAddress String?       @unique
  activityLogs  ActivityLog[]
  apiKeys       ApiKey[]
  media         Media[]
  role          Role          @relation(fields: [roleId], references: [id])

  @@index([roleId])
  @@index([walletAddress])
  @@index([privyId])
  @@map("users")
}

model ApiKey {
  id          String      @id @default(cuid())
  name        String
  key         String      @unique
  environment Environment @default(DEVELOPMENT)
  status      Status      @default(ACTIVE)
  lastUsed    DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "api_keys_userId_fkey")
  @@map("api_keys")
}

model Content {
  id        String      @id @default(cuid())
  type      ContentType @unique
  data      Json
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@map("contents")
}

model Media {
  id         String   @id @default(cuid())
  filename   String
  path       String
  size       Int
  mimeType   String
  alt        String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  uploadedBy String
  user       User     @relation(fields: [uploadedBy], references: [id])

  @@index([uploadedBy], map: "media_uploadedBy_fkey")
  @@map("media")
}

model ActivityLog {
  id         String   @id @default(cuid())
  action     String
  resource   String
  resourceId String?
  details    Json?
  createdAt  DateTime @default(now())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "activity_logs_userId_fkey")
  @@map("activity_logs")
}

model Settings {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  category    String
  description String?
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@map("settings")
}

model ThemePreset {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  colors    Json
  isDefault Boolean  @default(false)
  isSystem  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([isDefault])
  @@map("theme_presets")
}

model Notification {
  id        String           @id @default(cuid())
  userId    String?
  type      NotificationType
  title     String
  message   String           @db.Text
  read      Boolean          @default(false)
  actionUrl String?
  createdAt DateTime         @default(now())

  @@index([userId])
  @@index([read])
  @@index([createdAt])
  @@map("notifications")
}

enum AuthMethod {
  EMAIL
  WEB3
  HYBRID
}

enum Environment {
  PRODUCTION
  DEVELOPMENT
  STAGING
}

enum Status {
  ACTIVE
  INACTIVE
}

enum ContentType {
  HERO
  FEATURES
  HOW_IT_WORKS
  ROADMAP
  FAQ
  STATS
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
}
